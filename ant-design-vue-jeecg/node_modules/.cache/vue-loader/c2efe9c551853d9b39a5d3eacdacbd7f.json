{"remainingRequest":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\src\\views\\system\\NewPermissionList.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\src\\views\\system\\NewPermissionList.vue","mtime":1618453704998},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1618457261991},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1605147250913},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1618457253212}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport PermissionModal from './modules/PermissionModal'\nimport { getSystemMenuList, getSystemSubmenu, getSystemSubmenuBatch } from '@/api/api'\nimport { JeecgListMixin } from '@/mixins/JeecgListMixin'\nimport PermissionDataRuleList from './PermissionDataRuleList'\nimport JEllipsis from '@/components/jeecg/JEllipsis'\n\nconst columns = [\n  {\n    title: '菜单名称',\n    dataIndex: 'name',\n    key: 'name'\n  }, {\n    title: '菜单类型',\n    dataIndex: 'menuType',\n    key: 'menuType',\n    customRender: function(text) {\n      if (text == 0) {\n        return '菜单'\n      } else if (text == 1) {\n        return '菜单'\n      } else if (text == 2) {\n        return '按钮/权限'\n      } else {\n        return text\n      }\n    }\n  },/*{\n    title: '权限编码',\n    dataIndex: 'perms',\n    key: 'permissionCode',\n  },*/{\n    title: 'icon',\n    dataIndex: 'icon',\n    key: 'icon'\n  },\n  {\n    title: '组件',\n    dataIndex: 'component',\n    key: 'component',\n    scopedSlots: { customRender: 'component' }\n  },\n  {\n    title: '路径',\n    dataIndex: 'url',\n    key: 'url',\n    scopedSlots: { customRender: 'url' }\n  },\n  {\n    title: '排序',\n    dataIndex: 'sortNo',\n    key: 'sortNo'\n  },\n  {\n    title: '操作',\n    dataIndex: 'action',\n    scopedSlots: { customRender: 'action' },\n    align: 'center',\n    width: 150\n  }\n]\n\nexport default {\n  name: 'PermissionListAsync',\n  mixins: [JeecgListMixin],\n  components: {\n    PermissionDataRuleList,\n    PermissionModal,\n    JEllipsis\n  },\n  data() {\n    return {\n      description: '这是菜单管理页面',\n      // 表头\n      columns: columns,\n      loading: false,\n      // 展开的行，受控属性\n      expandedRowKeys: [],\n      url: {\n        list: '/sys/permission/list',\n        delete: '/sys/permission/delete',\n        deleteBatch: '/sys/permission/deleteBatch'\n      }\n    }\n  },\n  methods: {\n    loadData() {\n      this.loading = true\n      getSystemMenuList().then((res) => {\n        if (res.success) {\n          this.dataSource = res.result\n          return this.loadDataByExpandedRows(this.dataSource)\n        }\n      }).finally(()=>{\n        this.loading = false\n      })\n    },\n    expandSubmenu(expanded, record){\n      if (expanded && (!record.children || record.children.length === 0)) {\n        getSystemSubmenu({parentId:record.id}).then((res) => {\n          if (res.success) {\n            record.children = res.result\n          }\n        })\n      }\n    },\n    // 根据已展开的行查询数据（用于保存后刷新时异步加载子级的数据）\n    loadDataByExpandedRows(dataList) {\n      if (this.expandedRowKeys.length > 0) {\n        return getSystemSubmenuBatch({ parentIds: this.expandedRowKeys.join(',') }).then((res) => {\n          if (res.success) {\n            let childrenMap = res.result\n            let fn = (list) => {\n              list.forEach(data => {\n                if (this.expandedRowKeys.includes(data.id)) {\n                  data.children = childrenMap[data.id]\n                  fn(data.children)\n                }\n              })\n            }\n            fn(dataList)\n          }\n        })\n      } else {\n        return Promise.resolve()\n      }\n    },\n    // 打开数据规则编辑\n    handleDataRule(record) {\n      this.$refs.PermissionDataRuleList.edit(record)\n    },\n    handleAddSub(record) {\n      this.$refs.modalForm.title = \"添加子菜单\";\n      this.$refs.modalForm.localMenuType = 1;\n      this.$refs.modalForm.disableSubmit = false;\n      this.$refs.modalForm.edit({status:'1',permsType:'1',route:true,'parentId':record.id});\n    },\n    handleExpandedRowsChange(expandedRows) {\n      this.expandedRowKeys = expandedRows\n    },\n  }\n}\n",null]}