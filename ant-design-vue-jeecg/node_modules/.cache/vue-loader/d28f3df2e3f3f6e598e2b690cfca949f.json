{"remainingRequest":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\src\\views\\system\\modules\\UserRecycleBinModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\src\\views\\system\\modules\\UserRecycleBinModal.vue","mtime":1618453705016},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1618457261991},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1605147250913},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1618457253212}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n// 高度封装的请求，请务必使用 superRequest.call(this,{}) 的方式调用\nfunction superRequest(options) {\n  this.loading = !!options.loading\n  options.promise.then(res => {\n    if (res.success && typeof options.success === 'function') {\n      options.success(res)\n    } else {\n      throw new Error(res.message)\n    }\n  }).catch(e => {\n    console.error('查询已删除的用户失败：', e)\n    this.$message.warning('查询已删除的用户失败：' + (e.message || e))\n  }).finally(() => {\n    this.loading = false\n  })\n}\n\nexport default {\n  name: 'UserRecycleBinModal',\n  props: {\n    visible: {\n      type: Boolean,\n      default: false\n    },\n  },\n  data() {\n    return {\n      title: '用户回收站',\n      loading: false,\n      innerVisible: false,\n      selectedRowKeys: [],\n      dataSource: [],\n      columns: [\n        { title: '#', align: 'center', key: 'rowIndex', width: 80, customRender: (t, r, i) => i + 1 },\n        { title: '账号', align: 'center', dataIndex: 'username' },\n        { title: '姓名', align: 'center', dataIndex: 'realname', },\n        { title: '头像', align: 'center', dataIndex: 'avatar', scopedSlots: { customRender: 'avatarslot' } },\n        { title: '部门', align: 'center', dataIndex: 'orgCode' },\n        { title: '操作', align: 'center', dataIndex: 'action', width: 200, scopedSlots: { customRender: 'action' } }\n      ],\n      url: {\n        getAvatar: (path) => `window._CONFIG['staticDomainURL']/${path}`,\n        // 回收站操作，get = 获取列表；put = 取回；delete = 彻底删除\n        recycleBin: '/sys/user/recycleBin',\n      },\n    }\n  },\n  watch: {\n    visible: {\n      immediate: true,\n      handler(val) {\n        if (val) {\n          this.loadData()\n        }\n        this.innerVisible = val\n      }\n    },\n    innerVisible(val) {\n      this.$emit('update:visible', val)\n    },\n  },\n  methods: {\n    loadData() {\n      superRequest.call(this, {\n        loading: true,\n        promise: this.$http.get(this.url.recycleBin),\n        success: res => this.dataSource = res.result\n      })\n    },\n    handleOk() {\n      this.loadData()\n      this.$emit('ok')\n    },\n    handleCancel() {\n      this.innerVisible = false\n    },\n    // 还原用户\n    handleRevert(userIds) {\n      this.$confirm({\n        title: '恢复用户',\n        content: `您确定要恢复这 ${userIds.length} 个用户吗？`,\n        centered: true,\n        onOk: () => {\n          superRequest.call(this, {\n            loading: true,\n            promise: this.$http.put(this.url.recycleBin, userIds),\n            success: () => {\n              this.handleOk()\n              this.handleClearSelection()\n              this.$message.success(`还原 ${userIds.length} 个用户成功！`)\n            }\n          })\n        }\n      })\n    },\n    // 彻底删除用户\n    handleDelete(userIds) {\n      this.$confirm({\n        title: '彻底删除用户',\n        content: (<div>\n          <p>您确定要彻底删除这 {userIds.length} 个用户吗？</p>\n          <p style=\"color:red;\">注意：彻底删除后将无法恢复，请谨慎操作！</p>\n        </div>),\n        centered: true,\n        onOk: () => {\n          superRequest.call(this, {\n            loading: true,\n            promise: this.$http.delete(this.url.recycleBin + `?userIds=${userIds.join(',')}`),\n            success: () => {\n              this.loadData()\n              this.handleClearSelection()\n              this.$message.success(`彻底删除 ${userIds.length} 个用户成功！`)\n            }\n          })\n        },\n      })\n    },\n    handleRevertBatch() {\n      this.handleRevert(this.selectedRowKeys)\n    },\n    handleDeleteBatch() {\n      this.handleDelete(this.selectedRowKeys)\n    },\n    handleClearSelection() {\n      this.handleTableSelectChange([], [])\n    },\n    handleTableSelectChange(selectedRowKeys, selectionRows) {\n      this.selectedRowKeys = selectedRowKeys\n      this.selectionRows = selectionRows\n    },\n  }\n}\n",null]}