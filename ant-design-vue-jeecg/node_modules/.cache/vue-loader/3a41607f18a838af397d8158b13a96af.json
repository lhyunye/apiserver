{"remainingRequest":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\src\\views\\system\\modules\\DeptRoleAuthModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\src\\views\\system\\modules\\DeptRoleAuthModal.vue","mtime":1618453705007},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\babel-loader\\lib\\index.js","mtime":1618457261991},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1605147250913},{"path":"E:\\gitData\\wangfuj\\jeecg-boot\\ant-design-vue-jeecg\\node_modules\\vue-loader\\lib\\index.js","mtime":1618457253212}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {queryTreeListForDeptRole,queryDeptRolePermission,saveDeptRolePermission} from '@/api/api'\nimport RoleDataruleModal from './RoleDataruleModal.vue'\nimport DeptRoleDataruleModal from './DeptRoleDataruleModal'\n\nexport default {\n  name: \"DeptRoleAuthModal\",\n  components:{\n    DeptRoleDataruleModal,\n    RoleDataruleModal\n  },\n  data(){\n    return {\n      departId:\"\",\n      roleId:\"\",\n      treeData: [],\n      defaultCheckedKeys:[],\n      checkedKeys:[],\n      halfCheckedKeys:[],\n      expandedKeysss:[],\n      allTreeKeys:[],\n      autoExpandParent: true,\n      checkStrictly: false,\n      title:\"部门角色权限配置\",\n      visible: false,\n      loading: false,\n      selectedKeys:[]\n    }\n  },\n  methods: {\n    onTreeNodeSelect(id){\n      if(id && id.length>0){\n        this.selectedKeys = id\n      }\n      this.$refs.datarule.show(this.selectedKeys[0],this.departId,this.roleId)\n    },\n    onCheck (checkedKeys, { halfCheckedKeys }) {\n      // 保存选中的和半选中的，后面保存的时候合并提交\n      this.checkedKeys = checkedKeys\n      this.halfCheckedKeys = halfCheckedKeys\n    },\n    show(roleId,departId){\n      this.departId = departId\n      this.roleId=roleId\n      this.visible = true;\n    },\n    close () {\n      this.reset()\n      this.$emit('close');\n      this.visible = false;\n    },\n    onExpand(expandedKeys){\n      this.expandedKeysss = expandedKeys;\n      this.autoExpandParent = false\n    },\n    reset () {\n      this.expandedKeysss = []\n      this.checkedKeys = []\n      this.defaultCheckedKeys = []\n      this.loading = false\n    },\n    expandAll () {\n      this.expandedKeysss = this.allTreeKeys\n    },\n    closeAll () {\n      this.expandedKeysss = []\n    },\n    checkALL () {\n      this.checkedKeys = this.allTreeKeys\n    },\n    cancelCheckALL () {\n      this.checkedKeys = []\n    },\n    handleCancel () {\n      this.close()\n    },\n    handleSubmit(exit) {\n      let that = this;\n      let checkedKeys = [...that.checkedKeys, ...that.halfCheckedKeys]\n      const permissionIds = checkedKeys.join(\",\")\n      let params =  {\n        roleId:that.roleId,\n        permissionIds,\n        lastpermissionIds:that.defaultCheckedKeys.join(\",\"),\n      };\n      that.loading = true;\n      console.log(\"请求参数：\",params);\n      saveDeptRolePermission(params).then((res)=>{\n        if(res.success){\n          that.$message.success(res.message);\n          that.loading = false;\n          if (exit) {\n            that.close()\n          }\n        }else {\n          that.$message.error(res.message);\n          that.loading = false;\n          if (exit) {\n            that.close()\n          }\n        }\n        this.loadData();\n      })\n    },\n    convertTreeListToKeyLeafPairs(treeList, keyLeafPair = []) {\n      for(const {key, isLeaf, children} of treeList) {\n        keyLeafPair.push({key, isLeaf})\n        if(children && children.length > 0) {\n          this.convertTreeListToKeyLeafPairs(children, keyLeafPair)\n        }\n      }\n      return keyLeafPair;\n    },\n    loadData(){\n      queryTreeListForDeptRole({departId:this.departId}).then((res) => {\n        this.treeData = res.result.treeList\n        this.allTreeKeys = res.result.ids\n        const keyLeafPairs = this.convertTreeListToKeyLeafPairs(this.treeData)\n        queryDeptRolePermission({roleId:this.roleId}).then((res)=>{\n          // 过滤出 leaf node 即可，即选中的\n          // Tree组件中checkStrictly默认为false的时候，选中子节点，父节点会自动设置选中或半选中\n          // 保存 checkedKeys 以及 halfCheckedKeys 以便于未做任何操作时提交表单数据\n          const checkedKeys = [...res.result].filter(key => {\n            const keyLeafPair = keyLeafPairs.filter(item => item.key === key)[0]\n            return keyLeafPair && keyLeafPair.isLeaf\n          })\n          const halfCheckedKeys = [...res.result].filter(key => {\n            const keyLeafPair = keyLeafPairs.filter(item => item.key === key)[0]\n            return keyLeafPair && !keyLeafPair.isLeaf\n          })\n          this.checkedKeys = [...checkedKeys];\n          this.halfCheckedKeys = [...halfCheckedKeys]\n          this.defaultCheckedKeys = [...halfCheckedKeys, ...checkedKeys];\n          this.expandedKeysss = this.allTreeKeys;\n        })\n      })\n    }\n  },\n  watch: {\n    visible () {\n      if (this.visible ) {\n        this.loadData();\n      }\n    }\n  }\n}\n\n",null]}